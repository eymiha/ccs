<!Doctype html>

<style>
  .c {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px #ffffff solid;
  }

  .unmolded {
    border-color: #ff0000;
  }

  .match {
    border-color: #000000;
  }

  hr {
    height: 20px;
    visibility: hidden;
  }
</style>

<script>
  function CrossSpace(n, shape) {
    let mold = (shape) => {
      return (x) => {
        return (Math.random() > 0.01) ? shape() : { 'unmolded': 'unmolded' }
      }
    }

    this.induce = (quality) => { this.c.map(quality) }

    this.c = Array.from({length: n}, mold(shape))
  }

  colorful = (x) => {
    let red = Math.random()
    let green = Math.random()
    let blue = Math.random()
    return { red, green, blue }
  }

  color_cvt = (c) => {
    return ("0"+(Math.round(c.red  *255)).toString(16)).substr(-2)+
           ("0"+(Math.round(c.green*255)).toString(16)).substr(-2)+
           ("0"+(Math.round(c.blue *255)).toString(16)).substr(-2)
  }

  var cs = new CrossSpace(1000, colorful)

  bluegreen = (x) => {
    if ((x.red < x.green/2) && (x.red < x.blue/2) && (x.green > 0.3) && (x.blue > 0.3)) {
      let log = Math.log2(x.green/x.blue)
      if (Math.abs(log+0.1) < 0.75) {
        x.bluegreen = log
      }
    }
  }

  cs.induce(bluegreen)

  is_flt = (c, q, t) => { return (c[q] > t) }

  cs.c.map((x) => {
    let xf = is_flt(x, 'bluegreen', 0.5)
    document.write("<div class='c "+(x.unmolded || "")+(xf ? " match" : "")+"' style='background: #"+color_cvt(x)+"'))></div>")
  })
  document.write("<hr/>")
  cs.c.map((x) => {
    let xf = is_flt(x, 'bluegreen', -2)
    if (xf === true) {
      console.log(x)
      document.write("<div class='c' style='background: #"+color_cvt(x)+"'></div>")
    }
  })
</script>
